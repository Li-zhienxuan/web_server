# æœåŠ¡å™¨ç”ŸæˆSSHå¯†é’¥å¯¹æŒ‡å—

## ğŸ” ç”ŸæˆSSHå¯†é’¥å¯¹

### 1. ç™»å½•æœåŠ¡å™¨å¹¶ç”Ÿæˆå¯†é’¥
```bash
# ç™»å½•åˆ°ä½ çš„æœåŠ¡å™¨
ssh root@your_server_ip

# åˆ‡æ¢åˆ°è¦é…ç½®å¯†é’¥çš„ç”¨æˆ·ï¼ˆå¦‚æœæ˜¯ä¸ºç‰¹å®šç”¨æˆ·ç”Ÿæˆï¼‰
su - username

# ç”ŸæˆED25519å¯†é’¥ï¼ˆæ¨èï¼Œæ›´å®‰å…¨æ›´å¿«ï¼‰
ssh-keygen -t ed25519 -C "your_email@example.com" -f ~/.ssh/id_ed25519

# æˆ–è€…ç”ŸæˆRSAå¯†é’¥ï¼ˆå…¼å®¹æ€§æ›´å¥½ï¼‰
ssh-keygen -t rsa -b 4096 -C "your_email@example.com" -f ~/.ssh/id_rsa
```

### 2. å¯†é’¥ç”Ÿæˆè¿‡ç¨‹ä¸­çš„é€‰é¡¹
ç³»ç»Ÿä¼šæç¤ºä½ ï¼š
- **è¾“å…¥å¯†ç çŸ­è¯­**ï¼ˆæ¨èè®¾ç½®ï¼Œå¢åŠ å®‰å…¨æ€§ï¼‰
- **ç¡®è®¤å¯†ç çŸ­è¯­**

ç¤ºä¾‹è¾“å‡ºï¼š
```
Generating public/private ed25519 key pair.
Enter passphrase (empty for no passphrase): [è¾“å…¥å¯†ç ]
Enter same passphrase again: [å†æ¬¡è¾“å…¥å¯†ç ]
Your identification has been saved in /home/username/.ssh/id_ed25519
Your public key has been saved in /home/username/.ssh/id_ed25519.pub
```

## ğŸ“ è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™

```bash
# ç¡®ä¿.sshç›®å½•å­˜åœ¨ä¸”æƒé™æ­£ç¡®
mkdir -p ~/.ssh
chmod 700 ~/.ssh

# è®¾ç½®ç§é’¥æƒé™ï¼ˆå¿…é¡»ä¸¥æ ¼ï¼‰
chmod 600 ~/.ssh/id_ed25519

# è®¾ç½®å…¬é’¥æƒé™
chmod 644 ~/.ssh/id_ed25519.pub

# è®¾ç½®authorized_keysæ–‡ä»¶æƒé™ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
chmod 600 ~/.ssh/authorized_keys
```

## ğŸ”— é…ç½®å…¬é’¥è®¤è¯

### 1. å°†å…¬é’¥æ·»åŠ åˆ°authorized_keys
```bash
# å°†å…¬é’¥æ·»åŠ åˆ°æˆæƒæ–‡ä»¶
cat ~/.ssh/id_ed25519.pub >> ~/.ssh/authorized_keys

# æˆ–è€…ä½¿ç”¨ssh-copy-idï¼ˆå¦‚æœè¦ä»å…¶ä»–æœºå™¨å¤åˆ¶ï¼‰
# ssh-copy-id -i ~/.ssh/id_ed25519.pub username@server_ip
```

### 2. éªŒè¯authorized_keysæ–‡ä»¶
```bash
# æ£€æŸ¥æ–‡ä»¶å†…å®¹
cat ~/.ssh/authorized_keys

# ç¡®ä¿æ–‡ä»¶æƒé™æ­£ç¡®
chmod 600 ~/.ssh/authorized_keys
```

##âš™ï¸ é…ç½®SSHæœåŠ¡å™¨

### 1. ç¼–è¾‘SSHæœåŠ¡å™¨é…ç½®
```bash
sudo nano /etc/ssh/sshd_config
```

### 2. ç¡®ä¿ä»¥ä¸‹è®¾ç½®æ­£ç¡®
```bash
# å¯ç”¨å…¬é’¥è®¤è¯
PubkeyAuthentication yes

# å…¬é’¥æ–‡ä»¶è·¯å¾„
AuthorizedKeysFile .ssh/authorized_keys

# å¯ä»¥é€‰æ‹©ç¦ç”¨å¯†ç è®¤è¯ï¼ˆæ›´å®‰å…¨ï¼‰
PasswordAuthentication no

# å…è®¸çš„ç”¨æˆ·ï¼ˆå¯é€‰ï¼‰
AllowUsers username

# ç¦ç”¨rootç™»å½•ï¼ˆæ¨èï¼‰
PermitRootLogin no
```

### 3. é‡å¯SSHæœåŠ¡
```bash
# Ubuntu/Debian
sudo systemctl restart ssh

# CentOS/RHEL
sudo systemctl restart sshd
```

## ğŸ“¤ ä¸‹è½½ç§é’¥åˆ°æœ¬åœ°ï¼ˆå¯é€‰ï¼‰

### æ–¹æ³•1ï¼šä½¿ç”¨scpä¸‹è½½
```bash
# ä»æœ¬åœ°æœºå™¨æ‰§è¡Œï¼Œä¸‹è½½ç§é’¥
scp username@server_ip:~/.ssh/id_ed25519 ~/.ssh/server_key

# è®¾ç½®æœ¬åœ°æƒé™
chmod 600 ~/.ssh/server_key
```

### æ–¹æ³•2ï¼šå¤åˆ¶ç²˜è´´å†…å®¹
```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ˜¾ç¤ºç§é’¥å†…å®¹
cat ~/.ssh/id_ed25519

# ç„¶åæ‰‹åŠ¨å¤åˆ¶å†…å®¹åˆ°æœ¬åœ°æ–‡ä»¶
```

## ğŸ§ª æµ‹è¯•SSHå¯†é’¥ç™»å½•

### 1. ä»æœ¬åœ°æœºå™¨æµ‹è¯•è¿æ¥
```bash
# ä½¿ç”¨å¯†é’¥ç™»å½•
ssh -i ~/.ssh/server_key username@server_ip

# å¦‚æœä½¿ç”¨é»˜è®¤å¯†é’¥åç§°ï¼Œå¯ä»¥çœç•¥ -i å‚æ•°
ssh username@server_ip
```

### 2. è°ƒè¯•è¿æ¥é—®é¢˜
```bash
# æ˜¾ç¤ºè¯¦ç»†è¿æ¥ä¿¡æ¯
ssh -vvv -i ~/.ssh/server_key username@server_ip
```

## ğŸ”„ ç®¡ç†å¤šä¸ªå¯†é’¥

### åˆ›å»ºSSHé…ç½®æ–‡ä»¶
åœ¨æœ¬åœ°æœºå™¨åˆ›å»º `~/.ssh/config`ï¼š

```bash
Host myserver
    HostName your_server_ip
    User username
    IdentityFile ~/.ssh/server_key
    Port 22

Host github
    HostName github.com
    User git
    IdentityFile ~/.ssh/id_ed25519_github
```

## ğŸ›¡ï¸ å®‰å…¨æœ€ä½³å®è·µ

### 1. ä½¿ç”¨å¼ºå¯†ç çŸ­è¯­
```bash
# æ›´æ”¹å¯†é’¥å¯†ç 
ssh-keygen -p -f ~/.ssh/id_ed25519
```

### 2. å¤‡ä»½å¯†é’¥
```bash
# å¤‡ä»½æ•´ä¸ª.sshç›®å½•
tar -czf ssh_backup.tar.gz ~/.ssh

# å®‰å…¨å­˜å‚¨å¤‡ä»½æ–‡ä»¶
```

### 3. æ’¤é”€å¯†é’¥
å¦‚æœéœ€è¦æ’¤é”€å¯†é’¥ï¼Œåªéœ€ä»æœåŠ¡å™¨çš„ `~/.ssh/authorized_keys` æ–‡ä»¶ä¸­åˆ é™¤å¯¹åº”çš„å…¬é’¥ã€‚

### 4. ç›‘æ§SSHç™»å½•
```bash
# æŸ¥çœ‹SSHç™»å½•æ—¥å¿—
sudo tail -f /var/log/auth.log | grep ssh

# æŸ¥çœ‹å½“å‰SSHè¿æ¥
who
w
```

## âŒ å¸¸è§é—®é¢˜è§£å†³

### æƒé™é—®é¢˜
```bash
# ä¿®å¤SSHç›®å½•æƒé™
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
chmod 600 ~/.ssh/id_ed25519
```

### è¿æ¥è¢«æ‹’ç»
```bash
# æ£€æŸ¥SSHæœåŠ¡çŠ¶æ€
sudo systemctl status ssh

# æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
sudo ufw status
```

### å¯†é’¥ä¸è¢«æ¥å—
```bash
# éªŒè¯å…¬é’¥æ ¼å¼
ssh-keygen -l -f ~/.ssh/id_ed25519.pub

# æ£€æŸ¥authorized_keysæ–‡ä»¶æ ¼å¼
cat ~/.ssh/authorized_keys
```

æŒ‰ç…§ä»¥ä¸Šæ­¥éª¤ï¼Œä½ å°±å¯ä»¥åœ¨æœåŠ¡å™¨ä¸ŠæˆåŠŸç”ŸæˆSSHå¯†é’¥å¯¹ï¼Œå¹¶é…ç½®å®‰å…¨çš„å¯†é’¥è®¤è¯ç™»å½•æ–¹å¼ã€‚è®°å¾—æµ‹è¯•è¿æ¥å¹¶ç¡®ä¿å¤‡ä»½å¥½ä½ çš„ç§é’¥ã€‚