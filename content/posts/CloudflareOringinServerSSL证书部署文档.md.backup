# Cloudflare SSLè¯ä¹¦éƒ¨ç½²æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›®         | å†…å®¹                             |
| ------------ | -------------------------------- |
| **éƒ¨ç½²äºº**   | å“ˆåŸºç±³                           |
| **ä½œè€…**     | å“ˆåŸºç±³                           |
| **éƒ¨ç½²æ—¶é—´** | 2025å¹´10æœˆ14æ—¥ æ˜ŸæœŸäºŒ            |
| **éƒ¨ç½²ç±»å‹** | Cloudflare SSLè¯ä¹¦é…ç½®ä¸æ•…éšœæ’é™¤ |
| **æ–‡æ¡£ç‰ˆæœ¬** | v1.0                             |

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

æœ¬æ¬¡éƒ¨ç½²ä¸»è¦è§£å†³ç½‘ç«™ `lilyxuan.online` çš„Cloudflare SSL 526é”™è¯¯ï¼Œé€šè¿‡æ­£ç¡®é…ç½®Origin CAè¯ä¹¦ï¼Œç¡®ä¿HTTPSæ­£å¸¸è®¿é—®å’Œcloud playeræœåŠ¡æ­£å¸¸è¿è¡Œã€‚

## ğŸŒ ç¯å¢ƒä¿¡æ¯

### æœåŠ¡å™¨ä¿¡æ¯
- **æœåŠ¡å™¨ç±»å‹**: Linux (Ubuntu/CentOS)
- **WebæœåŠ¡å™¨**: Nginx
- **è¯ä¹¦è·¯å¾„**: `/var/www/Cert_SSL/`
- **éƒ¨ç½²ç”¨æˆ·**: root

### åŸŸåä¿¡æ¯
- **ä¸»åŸŸå**: `lilyxuan.online`
- **å­åŸŸå**: `www.lilyxuan.online`
- **CDNæœåŠ¡**: Cloudflare

### ç½‘ç»œæ¶æ„
```
ç”¨æˆ· â†’ Cloudflare CDN â†’ æºç«™æœåŠ¡å™¨ (IP: 3.*.33.*)
```

## ğŸ”§ éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€é˜¶æ®µï¼šé—®é¢˜è¯Šæ–­

#### 1.1 åˆå§‹é—®é¢˜ç¡®è®¤
- **é—®é¢˜ç°è±¡**: è®¿é—®ç½‘ç«™å‡ºç°Cloudflare 526é”™è¯¯
- **é”™è¯¯ä¿¡æ¯**: `Invalid SSL certificate Error code 526`
- **æ ¹æœ¬åŸå› **: æºç«™æœåŠ¡å™¨SSLè¯ä¹¦æ— æ•ˆ

#### 1.2 è¯ä¹¦åŒ¹é…æ€§æ£€æŸ¥
```bash
# æ£€æŸ¥è¯ä¹¦å’Œç§é’¥æ˜¯å¦åŒ¹é…
openssl x509 -noout -modulus -in /var/www/Cert_SSL/Web_Origin_SSL.crt | openssl md5
openssl rsa -noout -modulus -in /var/www/Cert_SSL/Web_Origin_SSL.key | openssl md5

# åˆå§‹ç»“æœï¼ˆä¸åŒ¹é…ï¼‰ï¼š
# è¯ä¹¦MD5: 36e31a66*****e207731b9daa
# ç§é’¥MD5: 36e31a66*****e207731b9daa
```

### ç¬¬äºŒé˜¶æ®µï¼šè¯ä¹¦é‡æ–°ç”Ÿæˆ

#### 2.1 Cloudflareè¯ä¹¦ç”Ÿæˆ
1. **ç™»å½•Cloudflareæ§åˆ¶å°**
   - å¯¼èˆªè‡³ï¼šSSL/TLS â†’ æºæœåŠ¡å™¨
   - æ’¤é”€ç°æœ‰ä¸åŒ¹é…çš„è¯ä¹¦

2. **åˆ›å»ºæ–°è¯ä¹¦é…ç½®**
   - **ç§é’¥ç±»å‹**: RSA (2048ä½)
   - **åŒ…å«åŸŸå**:
     - `lilyxuan.online`
     - `*.lilyxuan.online`
     - `www.lilyxuan.online`
   - **è¯ä¹¦æœ‰æ•ˆæœŸ**: 15å¹´
   - **åŠ å¯†æ–¹å¼**: ECCYPT

3. **ä¸‹è½½è¯ä¹¦å†…å®¹**
   - è¯ä¹¦æ–‡ä»¶å†…å®¹
   - ç§é’¥æ–‡ä»¶å†…å®¹

#### 2.2 æœåŠ¡å™¨è¯ä¹¦æ›´æ–°
```bash
# å¤‡ä»½åŸæœ‰è¯ä¹¦æ–‡ä»¶
cp /var/www/Cert_SSL/Web_Origin_SSL.crt /var/www/Cert_SSL/Web_Origin_SSL.crt.backup
cp /var/www/Cert_SSL/Web_Origin_SSL.key /var/www/Cert_SSL/Web_Origin_SSL.key.backup

# æ›´æ–°è¯ä¹¦æ–‡ä»¶å†…å®¹
vim /var/www/Cert_SSL/Web_Origin_SSL.crt
# ç²˜è´´æ–°çš„è¯ä¹¦å†…å®¹

vim /var/www/Cert_SSL/Web_Origin_SSL.key  
# ç²˜è´´æ–°çš„ç§é’¥å†…å®¹

# è®¾ç½®æ–‡ä»¶æƒé™
chmod 600 /var/www/Cert_SSL/Web_Origin_SSL.*
```

#### 2.3 è¯ä¹¦åŒ¹é…éªŒè¯
```bash
# éªŒè¯è¯ä¹¦å’Œç§é’¥åŒ¹é…æ€§
openssl x509 -noout -modulus -in /var/www/Cert_SSL/Web_Origin_SSL.crt | openssl md5
openssl rsa -noout -modulus -in /var/www/Cert_SSL/Web_Origin_SSL.key | openssl md5

# ä¿®å¤åç»“æœï¼ˆåŒ¹é…æˆåŠŸï¼‰ï¼š
# è¯ä¹¦MD5: d3b7ffd215****d889d0
# ç§é’¥MD5: d3b7ffd215****d889d0
```

### ç¬¬ä¸‰é˜¶æ®µï¼šNginxé…ç½®ä¼˜åŒ–

#### 3.1 ä¿®å¤Nginxé…ç½®
**æ–‡ä»¶ä½ç½®**: `/etc/nginx/sites-enabled/lilyxuan.online`

**é…ç½®å†…å®¹**:
```nginx
server {
    listen 443 ssl;
    http2 on;
    server_name lilyxuan.online www.lilyxuan.online;
    
    # SSLè¯ä¹¦é…ç½®
    ssl_certificate /var/www/Cert_SSL/Web_Origin_SSL.crt;
    ssl_certificate_key /var/www/Cert_SSL/Web_Origin_SSL.key;
    
    # SSLå®‰å…¨é…ç½®
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-CHACHA20-POLY1305;
    ssl_prefer_server_ciphers off;
    
    # ç½‘ç«™æ ¹ç›®å½•
    root /var/www/html;
    index index.html index.php;
    
    # Cloud Playerä¼˜åŒ–é…ç½®
    client_max_body_size 100M;
    
    location / {
        try_files $uri $uri/ =404;
    }
}

# HTTPé‡å®šå‘åˆ°HTTPS
server {
    listen 80;
    server_name lilyxuan.online www.lilyxuan.online;
    return 301 https://$server_name$request_uri;
}
```

#### 3.2 é…ç½®éªŒè¯ä¸é‡å¯
```bash
# æµ‹è¯•Nginxé…ç½®è¯­æ³•
nginx -t

# é‡æ–°åŠ è½½Nginxé…ç½®
systemctl reload nginx

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status nginx
```

### ç¬¬å››é˜¶æ®µï¼šCloudflareé…ç½®è°ƒæ•´

#### 4.1 SSLæ¨¡å¼è°ƒæ•´
- **ä¹‹å‰æ¨¡å¼**: çµæ´»(Flexible)
- **ç›®æ ‡æ¨¡å¼**: å®Œå…¨(Full)
- **é…ç½®è·¯å¾„**: Cloudflareæ§åˆ¶å° â†’ SSL/TLS â†’ æ¦‚è¿°

#### 4.2 DNSè®°å½•éªŒè¯
- ç¡®è®¤Aè®°å½•æŒ‡å‘æ­£ç¡®IP
- éªŒè¯ä»£ç†çŠ¶æ€ä¸º"å·²ä»£ç†"
- æ£€æŸ¥TTLè®¾ç½®

## ğŸ› é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1: SSL 526é”™è¯¯
**ç—‡çŠ¶**: è®¿é—®ç½‘ç«™æ˜¾ç¤º"Invalid SSL certificate"
**åŸå› **: æºç«™è¯ä¹¦æ— æ•ˆ
**è§£å†³æ–¹æ¡ˆ**: é‡æ–°ç”Ÿæˆå¹¶é…ç½®Cloudflare Origin CAè¯ä¹¦

### é—®é¢˜2: è¯ä¹¦ç§é’¥ä¸åŒ¹é…
**ç—‡çŠ¶**: Nginxé…ç½®æµ‹è¯•å¤±è´¥ï¼Œæç¤º"key values mismatch"
**åŸå› **: è¯ä¹¦æ–‡ä»¶å’Œç§é’¥æ–‡ä»¶ä¸åŒ¹é…
**è§£å†³æ–¹æ¡ˆ**: 
1. é‡æ–°ç”ŸæˆåŒ¹é…çš„è¯ä¹¦å¯¹
2. æ­£ç¡®å¤åˆ¶ç²˜è´´è¯ä¹¦å†…å®¹
3. éªŒè¯MD5æŒ‡çº¹åŒ¹é…

### é—®é¢˜3: Nginx http2è­¦å‘Š
**ç—‡çŠ¶**: `the "listen ... http2" directive is deprecated`
**åŸå› **: Nginxç‰ˆæœ¬æ›´æ–°å¯¼è‡´è¯­æ³•å˜æ›´
**è§£å†³æ–¹æ¡ˆ**: 
- å°† `listen 443 ssl http2;` æ”¹ä¸º `listen 443 ssl;` å’Œ `http2 on;`

## âœ… éªŒè¯ç»“æœ

### åŠŸèƒ½éªŒè¯æ¸…å•

| æµ‹è¯•é¡¹ç›®           | ç»“æœ   | å¤‡æ³¨                        |
| ------------------ | ------ | --------------------------- |
| HTTPSè®¿é—®ä¸»åŸŸå    | âœ… é€šè¿‡ | https://lilyxuan.online     |
| HTTPSè®¿é—®wwwå­åŸŸå | âœ… é€šè¿‡ | https://www.lilyxuan.online |
| HTTPé‡å®šå‘åˆ°HTTPS  | âœ… é€šè¿‡ | è‡ªåŠ¨è·³è½¬                    |
| SSLè¯ä¹¦æœ‰æ•ˆæ€§      | âœ… é€šè¿‡ | æµè§ˆå™¨æ˜¾ç¤ºå®‰å…¨é”            |
| Cloudflareä»£ç†çŠ¶æ€ | âœ… é€šè¿‡ | æ˜¾ç¤º"å·²ä»£ç†"                |
| Cloud PlayeråŠŸèƒ½   | âœ… é€šè¿‡ | æµåª’ä½“æ’­æ”¾æ­£å¸¸              |
| Nginxé…ç½®è¯­æ³•      | âœ… é€šè¿‡ | `nginx -t` æµ‹è¯•æˆåŠŸ         |

### æ€§èƒ½æŒ‡æ ‡
- **SSLæ¡æ‰‹æ—¶é—´**: æ­£å¸¸
- **é¡µé¢åŠ è½½é€Ÿåº¦**: ä¼˜åŒ–åæ˜¾è‘—æå‡
- **CDNç¼“å­˜çŠ¶æ€**: æ­£å¸¸å·¥ä½œ

## ğŸ“Š éƒ¨ç½²æ€»ç»“

### æˆåŠŸæŒ‡æ ‡
1. âœ… å½»åº•è§£å†³Cloudflare 526é”™è¯¯
2. âœ… å®ç°å…¨ç«™HTTPSåŠ å¯†è®¿é—®
3. âœ… ä¿æŒCloudflare CDNåŠ é€Ÿ benefits
4. âœ… ç¡®ä¿cloud playeræœåŠ¡ç¨³å®šæ€§
5. âœ… ä¼˜åŒ–Nginxé…ç½®æ€§èƒ½

### ç»éªŒæ•™è®­
1. **è¯ä¹¦ç®¡ç†**: ç¡®ä¿è¯ä¹¦å’Œç§é’¥å§‹ç»ˆåŒ¹é…
2. **é…ç½®éªŒè¯**: æ¯æ¬¡ä¿®æ”¹åå¿…é¡»æµ‹è¯•Nginxé…ç½®
3. **å¤‡ä»½ç­–ç•¥**: é‡è¦æ–‡ä»¶ä¿®æ”¹å‰å¿…é¡»å¤‡ä»½
4. **æ–‡æ¡£è®°å½•**: è¯¦ç»†è®°å½•é…ç½®å˜æ›´ä¾¿äºæ’æŸ¥

### åç»­ç»´æŠ¤å»ºè®®
1. **è¯ä¹¦ç›‘æ§**: è®¾ç½®è¯ä¹¦è¿‡æœŸæé†’ï¼ˆ15å¹´æœ‰æ•ˆæœŸï¼‰
2. **å®šæœŸæ£€æŸ¥**: æ¯æœˆéªŒè¯SSLé…ç½®çŠ¶æ€
3. **æ›´æ–°ç­–ç•¥**: å…³æ³¨Nginxå’ŒOpenSSLå®‰å…¨æ›´æ–°
4. **ç›‘æ§å‘Šè­¦**: é…ç½®ç½‘ç«™å¯ç”¨æ€§ç›‘æ§

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

- è¯ä¹¦ç§é’¥æ–‡ä»¶æƒé™è®¾ç½®ä¸º600
- å®šæœŸè½®æ¢è¯ä¹¦å¯†é’¥
- ç›‘æ§Cloudflareå®‰å…¨äº‹ä»¶æ—¥å¿—
- å¯ç”¨åˆé€‚çš„WAFè§„åˆ™ä¿æŠ¤cloud playeræœåŠ¡

---
**æ–‡æ¡£ç»“æŸ**  
*éƒ¨ç½²å®Œæˆæ—¶é—´: 2025å¹´10æœˆ14æ—¥ 17:30 UTC+8*  
*ä¸‹æ¬¡å®¡æ ¸æ—¶é—´: 2026å¹´4æœˆ14æ—¥*